<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AR.js + Three.js â€” Hiro Marker Demo</title>
  <style>
    html,body{margin:0;padding:0;height:100%;overflow:hidden;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
    #info{position:fixed;left:12px;top:12px;background:rgba(0,0,0,0.5);color:#fff;padding:8px 10px;border-radius:8px;z-index:2}
    #startBtn{margin-top:6px;padding:6px 10px;border-radius:6px;border:none;background:#1e88e5;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div id="info">
    AR.js + Three.js demo (Hiro marker)
    <div style="font-size:12px;opacity:0.9">Point your camera at the <strong>Hiro marker</strong> (see notes).</div>
  </div>

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <!-- AR.js (Three.js build) -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex.js"></script>

  <script>
  // Basic AR.js + Three.js setup
  // By default this example uses the HIRO marker. You can print the marker or show it on another screen.

  let scene, camera, renderer;
  let arToolkitSource, arToolkitContext;
  let markerRoot;

  init();
  animate();

  function init(){
    // Renderer
    renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.domElement.style.position = 'absolute';
    renderer.domElement.style.top = '0px';
    renderer.domElement.style.left = '0px';
    document.body.appendChild(renderer.domElement);

    // Scene and camera
    scene = new THREE.Scene();

    camera = new THREE.Camera();
    scene.add(camera);

    // AR Toolkit Source (handles camera stream)
    arToolkitSource = new THREEx.ArToolkitSource({
      sourceType: 'webcam', // other options: 'image' or 'video'
    });

    function onResize(){
      arToolkitSource.onResizeElement();
      arToolkitSource.copyElementSizeTo(renderer.domElement);
      if (arToolkitContext.arController !== null){
        arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas);
      }
    }

    arToolkitSource.init(function onReady(){
      onResize();
    });

    // Handle resize
    window.addEventListener('resize', function(){
      onResize();
    });

    // AR Toolkit Context (marker detection)
    arToolkitContext = new THREEx.ArToolkitContext({
      cameraParametersUrl: 'https://raw.githack.com/AR-js-org/AR.js/master/three.js/data/camera_para.dat',
      detectionMode: 'mono'
    });

    // initialize it
    arToolkitContext.init(function onCompleted(){
      // copy projection matrix to camera
      camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
    });

    // Marker root object
    markerRoot = new THREE.Group();
    scene.add(markerRoot);

    // Use the default HIRO marker pattern (provided by AR.js repo)
    let markerControls = new THREEx.ArMarkerControls(arToolkitContext, markerRoot, {
      type: 'pattern',
      patternUrl: 'https://raw.githack.com/AR-js-org/AR.js/master/three.js/data/patt.hiro',
      // alternatively, you can use barcode markers or NFT markers
    });

    // Add a simple three.js object to the marker root: a spinning cube + a ground plane
    const cubeGeo = new THREE.BoxGeometry(1,1,1);
    const cubeMat = new THREE.MeshNormalMaterial({transparent:true, opacity:0.9});
    const cube = new THREE.Mesh(cubeGeo, cubeMat);
    cube.position.y = 0.5;
    markerRoot.add(cube);

    // A plane to act as 'ground' so the marker has a base
    const planeGeo = new THREE.PlaneGeometry(2,2);
    const planeMat = new THREE.MeshBasicMaterial({color:0xffffff, opacity:0.3, transparent:true});
    const plane = new THREE.Mesh(planeGeo, planeMat);
    plane.rotation.x = -Math.PI/2;
    markerRoot.add(plane);

    // A little ambient light (mostly to show how to add lights if using non-normal materials)
    const ambient = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambient);

    // Save cube globally so animate() can spin it
    window._arDemoCube = cube;
  }

  function update(){
    if (arToolkitSource && arToolkitSource.ready !== false){
      arToolkitContext.update(arToolkitSource.domElement);
    }
  }

  function render(){
    renderer.render(scene, camera);
  }

  function animate(){
    requestAnimationFrame(animate);
    update();

    // spin cube if visible
    const cube = window._arDemoCube;
    if (cube){
      cube.rotation.x += 0.02;
      cube.rotation.y += 0.03;
    }

    render();
  }

  // Helpful notes for testing in browsers
  // 1) For camera access to work reliably you must serve this file over HTTPS or from localhost.
  //    e.g. run: python -m http.server 8000  (then open http://localhost:8000/arjs-threejs-demo.html)
  // 2) Print or display the HIRO marker: https://raw.githack.com/AR-js-org/AR.js/master/three.js/data/hiro.jpg
  //    (hold it up to your camera, the cube should appear on top of it)
  // 3) If camera fails on some mobile devices, try using a different browser (Chrome/Firefox) and grant camera permission.

  </script>
</body>
</html>

